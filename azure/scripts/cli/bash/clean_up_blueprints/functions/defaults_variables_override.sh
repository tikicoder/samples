#!/bin/bash


tenant_id="97985a95-3d19-4d98-bad9-e1888267be41"

# this is I have ran into issues where not all old policies removed
existing_policies_tmp='["gr - Tag RetirementDate Auto Resource Group", "gr - Tag BusinessContact Auto Resource Group", "vm - Azure Monitoring Agent Windows", "gr - Tag CodeRepo Auto Resource Group", "gr - Inheirt Tag Criticality from Subscription on resource group", "gr - Tag Product Auto Resource Group", "vmss - Azure Monitoring Agent Linux", "vm - GR Azure Monitoring Agent Linux", "vm - Azure Monitoring Agent Windows", "gr - Tag RetirementDate Auto Resource Group", "gr - Tag BusinessContact Auto Resource Group", "gr - Tag Compliance Auto Resource Group", "gr - Tag Criticality Auto Resource Group", "gr - Tag ManagedBy Auto Resource Group", "vm - GR Azure Monitoring Agent Linux", "gr - Inheirt Tag RetirementDate from Subscription on resource group","gr - Require TAG RetirementDate on non resource groups","gr - Require TAG CodeRepo on non resource groups","gr - Require TAG RetirementDate on non resource groups","gr - Require TAG CodeRepo on non resource groups","gr - Require TAG BusinessOwner on non resource groups","gr - Require TAG ManagedBy on non resource groups","gr - Require TAG Environment on non resource groups","gr - Tag Auto Resource Group","vmss - automatic OS upgrade with app health","gr - Require TAG Criticality on non resource groups","gr - Require TAG Product on non resource groups","gr - Require TAG PublicFacing on non resource groups","gr - Require TAG BusinessContact on non resource groups","Inheirt Tag Environment from Subscription on resource group","gr - Resource possibly inherited from subscription tag","gr - Inheirt Tag Product from Subscription on resource group","backup - Configure backup on virtual machines without a given tag to an existing recovery services vault in the same location","resources - Deny","resources - set Diagnostic Logs Enabled","gr - Append TAG Criticality from resource group","gr - Append TAG Compliance from resource group","monitoring - Network Watcher","vm - CIS v1.1.0","Require TAG PublicFacing on resource groups","monitoring - set enable","Require TAG Compliance on resource groups","Require TAG BusinessContact on resource groups","Require TAG Environment on non resource groups", "Require TAG CodeRepo on non resource groups","Require TAG BusinessOwner on non resource groups","Require TAG BusinessOwner on non resource groups","Require TAG Criticality on non resource groups","Require TAG CodeRepo on non resource groups","Require TAG Environment on non resource groups","Require TAG BusinessContact on non resource groups","regions - Allowed Resource Group","Inheirt Tag Environment from Subscription","Require TAG Criticality on resource groups","gr - Append TAG RetirementDate from resource group","gr - Inheirt Tag Environment from Subscription on Resource Group","vm - IaaSAntimalware extension Windows","vmss - Log Analytics Agent Windows","Require TAG Environment on resource groups","Require TAG CodeRepo on resource groups","Require TAG ManagedBy on resource groups","vmss - automatic OS upgrade with app health","Require TAG Criticality on non resource groups","Require TAG Compliance on non resource groups","Require TAG Product on non resource groups","storage account - blob encryption Require","gr - Append TAG BusinessOwner from resource group","datalake - encrypt enable", "Append TAG BusinessContact from resource group","Append TAG BusinessOwner from resource group","Append TAG CodeRepo from resource group","Append TAG Compliance from resource group","Append TAG Criticality from resource group","Append TAG Environment from resource group","Append TAG ManagedBy from resource group","Append TAG Product to resource from resource group","Append TAG PublicFacing from resource group","Append TAG RetirementDate from resource group","Require TAG BusinessOwner on resource groups","Require TAG ManagedBy on non resource groups","Require TAG Product on resource groups","Require TAG PublicFacing on non resource groups","Require TAG RetirementDate on non resource groups","Require TAG RetirementDate on resource groups","gr - Append TAG BusinessContact from resource group","gr - Append TAG CodeRepo from resource group","gr - Append TAG Environment from resource group","gr - Append TAG ManagedBy from resource group","gr - Append TAG Product to resource from resource group","gr - Append TAG PublicFacing from resource group","gr - Inheirt Tag BusinessOwner from Subscription on resource group","gr - Inheirt Tag CodeRepo from Subscription on resource group","gr - Inheirt Tag ManagedBy from Subscription on resource group","gr - Require TAG BusinessContact on non resource groups","gr - Require TAG Compliance on non resource groups","gr - backup - Configure backup on virtual machines without a given tag to an existing recovery services vault in the same loc...","gr - backup - Configure backup on virtual machines without a given tag to an existing recovery services vault in the same location","regions - Allowed Resources","security - Security Center Enable","sql - Threat Detection","sql - transparent data encryption","storage account - Secure transfer enabled","storage account - allowed skus","vm - Log Analytics Agent Linux","vm - Log Analytics Agent Windows","vmss - Log Analytics Agent Linux"]'